---
apiVersion: xl-release/v1
kind: Templates
spec:
- directory: slack
  children:
  - template: Slack_Test
    scheduledStartDate: 2019-10-03T13:00:00Z
    dueDate: 2019-10-06T15:45:32.129Z
    phases:
    - phase: Send Messages
      tasks:
      - name: Send Message
        type: slack.Notification
        server: slackbot
        channel: '#general'
        message: Hello world
      - name: Verify Message
        type: xlrelease.GateTask
        owner: admin
      color: '#0099CC'
    - phase: New Channel
      tasks:
      - name: Create New Channel
        type: slack.CreateChannel
        server: slackbot
        channel: '#this-is-a-test'
        variableMapping:
          pythonScript.channelId: ${channelId}
      - name: Send Message to new channel
        type: slack.postMessage
        server: slackbot
        channelId: ${channelId}
        message: Hello to new channel
      - name: Verify Channel and Messages
        type: xlrelease.GateTask
        owner: admin
      color: '#08B153'
    - phase: Add Users to Channel
      tasks:
      - name: Add Users
        type: slack.AddUsersToChannel
        server: slackbot
        channel: ${channelId}
        users:
        - rick_broker@yahoo.com
      - name: Send Messages to new Users
        type: slack.postMessage
        server: slackbot
        channelId: ${channelId}
        message: Added Users
      - name: Verify users added and Messages
        type: xlrelease.GateTask
        owner: admin
      color: '#FD8D10'
    variables:
    - type: xlrelease.StringVariable
      key: channelId
      requiresValue: false
      showOnReleaseStart: false
    riskProfile: Default risk profile
